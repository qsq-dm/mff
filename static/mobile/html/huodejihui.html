<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/mobile/css/base.css">
    <link rel="stylesheet" type="text/css" href="/static/mobile/css/tanchuceng.css">
    <link rel="stylesheet" type="text/css" href="/static/mobile/css/yaoqinghaoyou2.css">
    <link rel="stylesheet" type="text/css" href="/static/mobile/css/index.css">
    <script type="text/javascript" src="/static/mobile/js/jquery-1.12.0.min.js"></script>
    <script type="text/javascript" src="/static/mobile/js/base.js"></script>
    <script type="text/javascript" src="/static/mobile/js/huodejihui.js"></script>
    <script type="text/javascript" src="/static/mobile/js/index.js"></script>
     
    
<body>
<div class="bg hidden"></div>
<div class="tcc tcc1 hidden">
    <div class="haode"></div>
</div>
<div class="tcc tcc2 hidden">
    <div class="haode"></div>
</div>
<div class="tcc tcc3 hidden">
    <div class="haode "></div>
    <div class="inTcc3">2</div>
</div>
<div class="yaoqqinghaoyou hide">
          <div class="bg1"></div>
               <div class="share"></div>
             <div class="action1">
               <div><a href="javascript"><img src="../image/yaoqing.png" ></a></div>
             </div>
</div>
    

<div class="content">
    
    <!--效果html开始-->
<div id="lottery" class="box">
  <table border="0" cellpadding="0" cellspacing="0">
    <tr>
      <td class="lottery-unit lottery-unit-0"></td>
      <td class="lottery-unit lottery-unit-1"></td>
      <td class="lottery-unit lottery-unit-2"></td>
            
    </tr>
    <tr>
      <td class="lottery-unit lottery-unit-7"></td>
      <td ><a href="#" class="go"><img src="../image/b5.png"></a></td>
      <td class="lottery-unit lottery-unit-3"></td>
    </tr>
    
        <tr>
      <td class="lottery-unit lottery-unit-6"></td>
      <td class="lottery-unit lottery-unit-5"></td>
      <td class="lottery-unit lottery-unit-4"></td>
            
    </tr>
    
  </table>
</div>


<script type="text/javascript">
var lottery={
  index:-1, //当前转动到哪个位置，起点位置
  count:0,  //总共有多少个位置
  timer:0,  //setTimeout的ID，用clearTimeout清除
  speed:20, //初始转动速度
  times:0,  //转动次数
  cycle:50, //转动基本次数：即至少需要转动多少次再进入抽奖环节
  prize:-1, //中奖位置
  init:function(id){
    if ($("#"+id).find(".lottery-unit").length>0) {
      $lottery = $("#"+id);
      $units = $lottery.find(".lottery-unit");
      this.obj = $lottery;
      this.count = $units.length;
      $lottery.find(".lottery-unit-"+this.index).addClass("active");
    };
  },
  roll:function(){
    var index = this.index;
    var count = this.count;
    var lottery = this.obj;
    $(lottery).find(".lottery-unit-"+index).removeClass("active");
    index += 1;
    if (index>count-1) {
      index = 0;
    };
    $(lottery).find(".lottery-unit-"+index).addClass("active");
    this.index=index;
    return false;
  },
  stop:function(index){
    this.prize=index;
    return false;
  }
};

function roll(){
  lottery.times += 1;
  lottery.roll();
  if (lottery.times > lottery.cycle+10 && lottery.prize==lottery.index) {
    clearTimeout(lottery.timer);
    //lottery.prize=-1;
    lottery.times=0;
    click=false;
  }else{
    if (lottery.times<lottery.cycle) {
      lottery.speed -= 10;
    }else if(lottery.times==lottery.cycle) {
      var index = Math.random()*(lottery.count)|0;
    }else{
      if (lottery.times > lottery.cycle+10 && ((lottery.prize==0 && lottery.index==7) || lottery.prize==lottery.index+1)) {
        lottery.speed += 110;
      }else{
        lottery.speed += 20;
      }
    }
    if (lottery.speed<40) {
      lottery.speed=40;
    };
    //console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
    lottery.timer = setTimeout(roll,lottery.speed);
  }
  return false;
}

var click=false;


function choose(prize_id) {
    if (click) {
      return false;
    }else{
      lottery.speed=100;
      lottery.prize=prize_id;
      roll();
      click=true;
      return false;
    }
}
window.onload=function(){
};
</script>
<!--效果html结束-->

<div class="box1"><a href="javascript">还剩<i class='choujiangcishu'></i>次机会</a></div>
<div class="foot">
   <div class="foot1 foot-menu current">获得机会</div>
   <div class="foot2 foot-menu">活动说明</div>

</div>

                  <div class="footer1">
                  <div class="footerIn1">
                      <p>申请额度获得通过
                        <span>1次领红包机会  <em class='shifouhuode-1'></em></span>
                      </p>
                  </div>
                  <div class="footerIn2"><a class="link-1">去申请额度</a></div>
                  <div class="footerIn1">
                      <p>邀请3位好友完成注册（<span class='invited-count-label'></span>/3）
                        <span>1次领红包机会  <em class='shifouhuode-2'></em></span>
                      </p>
                  </div>
                  <div class="footerIn2"><a class="link-2">去邀请</a></div>
                  <div class="footerIn1">
                      <p>首次完成分期整形
                        <span>3次领红包机会  <em class='shifouhuode-3'></em></span>
                      </p>
                  </div>
                  <div class="footerIn2"><a class="link-3">去下单</a></div>
               </div>
                <div class="footer2">
             <p>1、活动时间：2016-3.16至2016-4.16；<br/>
            2、本活动奖品包括：1元、3元、5元、10元、30元、50元、<br/>100元红包。抽取到的红包将通过美分分公众号派发；<br/>
            3、每次抽取红包须扣除1次机会，机会可通过完成任务获得。<br/>其中“邀请3位好友完成注册”任务，好友须通过你分享的专<br/>属二维码关注美分分公众号并注册；“申请额度获得通过”和<br/>“首次完成分期整形”任务”仅限没有通过额度申请和下过单的新用户参与；<br/>
             4、本活动的最终解释权归美分期网络科技（上海）有限公司所有，严禁作弊，一经发现，封号处理！</p>
                </div>

</div>
<script src='/static/user/js/util.js'></script>
<script type="text/javascript">
        jQuery(document).ready(function($) {
          function draw_prize() {
            $.ajax({
                    url: 'http://'+getHostName()+'/user/draw_prize/',
                    type: 'GET',
                    dataType: 'JSON',
               
                   success: function(data) {
                        if(data.code==0) {
                            choose(data.prize_id-1);
                        } else {
                            alert(data.msg);
                        }
                   },  
                  error:function(data) {
                   
                 }
            });
          }

          function bind_draw() {
            lottery.init('lottery');
              $("#lottery a").click(function(){
                draw_prize();
              });

          }

          $.ajax({
                    url: 'http://'+getHostName()+'/user/draw_index/',
                    type: 'GET',
                    dataType: 'JSON',
               
                   success: function(data) {
                        var link_map = {
                            1:'/user/menu_credit_apply/',
                            2:'/static/mobile/html/yaoqingjiaru.html',
                            3:'/user/index'
                            }
                        $('.choujiangcishu').text(data.draw_count);
                        $('.invited-count-label').text(data.invite_count);
                        for (var i in [1,2,3]) {
                            var index = parseInt(i)+1;
                            classnamelabel = '.shifouhuode-' + index;
                            linklabel      = '.link-' + index;
                            has_priviledge = data.priviledges[index]
                            if(has_priviledge) {
                                $(classnamelabel).html('已获得');
                            } else {
                                $(classnamelabel).html('未获得');
                            }
                            if(!data.has_followed) {
                                $(linklabel).attr('href', '/static/mobile/html/ruhecanyu.html');
                            } else {
                                $(linklabel).attr('href',  link_map[index]);
                            }
                        }
                        bind_draw();
                   },  
                  error:function(data) {
                   
                 }
          });
                 


     });          
  
</script>

</body>
</html>
