<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>待服务</title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
    <link rel="stylesheet" type="text/css" href="css/iconfont.css"/>
    <link rel="stylesheet" type="text/css" href="css/popover.css"/>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?61b678558a59e95c85431d0243d592ef";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

    <script type="text/javascript" charset="utf-8">
      	mui.init();
    </script>
    <style type="text/css">
    	
    	.mui-table-view .mui-media-object {
			height: 60px;
			max-width: 60px;
		}
		.mui-table-view .mui-media-body.has-top-padded{
			padding-top: 10px;
		}
		.mui-btn.mui-btn-outlined.mui-btn-primary{
			border-radius: 20px;
			padding: 3px 20px 1px 20px;
			margin-top: 6px;
			border: 1px solid #00abec;
			color: #00abec;
		}
		.mui-badge{
			background: none;
			padding: 0;
			color: #ffa200;
		}
		.mui-table-view.lower-table-view .mui-table-view-cell{
			padding: 6px 15px 0 15px;
			font-size: 12px;
			color: #9B9B9B;
		}
		.mui-table-view.lower-table-view .mui-table-view-cell.mui-active{
			background: #FFF;
		}
		.mui-table-view.lower-table-view{
			padding-bottom: 6px;
		}
		.serve-process {
			background: #FFF;
		}
		.serve-process .use-process li{
			width: 33.333%;
		}
		.serve-process .has-bg{
			padding: 14px 10px;
			color: #FFF;
			width: 90%;
			margin-left: 5%;
			border-top-right-radius: 4px;
			border-top-left-radius: 4px;
			position: relative;
			display: none;
		}
		.serve-process .has-bg .white-btn{
			position: absolute;
			bottom: 14px;
			right: 10px;
			padding:0 8px;
		}
		.serve-process .has-lr-padded{
			line-height: 30px;
		}
	.serve-process .has-bg .stamp {
		position: absolute;
		top: 10px;
		right: 14px;
		height: 60px;
		opacity: 0.5;
	}
    </style>
</head>
<body>
	<div class="mui-content" style='padding-bottom: 74px;'>
	    <div class="serve-process">
	    	<div class="has-bg bg-real-blue" id='audit'>
	    		<p class="color-white">服务验证码</p>
	    		<h4 class="color-white">额度审核中，请耐心等待</h4>
	    		<a class="mui-btn mui-btn-outlined circle-btn white-btn" href="/user/menu_credit_apply/">
	    			<i class="iconfont">&#xe610;</i>
	    			查看进度
	    		</a>
	    	</div>
	    	<div class="has-bg bg-grey" id='cancel'>
	    		<p class="color-white">服务验证码</p>
	    		<h4 class="color-white size-big">68921475647</h4>
	    		<img class="stamp" src="img/icon-concel.png"/>
	    	</div>
	    	<div class="has-bg bg-red" id='use'>
	    		<p class="color-white">服务验证码</p>
	    		<h4 class="color-white size-big">68921475647</h4>
	    		<img class="stamp" src="img/icon-used.png"/>
	    	</div>
	    	<div class="has-bg bg-real-blue" id='dontUse'>
	    		<p class="color-white">服务验证码</p>
	    		<h4 class="color-white size-big">68921475647</h4>
	    		<img class="stamp" src="img/icon-noused.png"/>
	    	</div>
	    	<p class="has-lr-padded color-black">消费流程</p>
	    	<ul class="use-process" style='padding-left:15px;'>
				<li>
					<div class="circle bg-red color-white">
						<!--<i class="iconfont">&#xe624;</i>-->
						<img class="sm-icon" src="img/icon-callout.png"/>
					</div>
					<i class="iconfont color-red pointo">&#xe62a;</i>
					<p class="size-sm color-black">电话预约医院</p>
				</li>
				<li>
					<div class="circle bg-blue color-white">
						<!--<i class="iconfont">&#xe628;</i>-->
						<img class="sm-icon" src="img/icon-checkcode.png"/>
					</div>
					<i class="iconfont color-blue pointo">&#xe62a;</i>
					<p class="size-sm color-black">携身份证和服<br />务码到院消费</p>
				</li>
				<li>
					<div class="circle bg-green color-white">
						<!--<i class="iconfont">&#xe633;</i>-->
						<img class="sm-icon" src="img/icon-smileface.png"/>
					</div>
					<p class="size-sm color-black">手术完成</p>
					<!--<i class="iconfont color-g">&#xe62a;</i>-->
				</li>
			</ul>

	    </div>
	    <ul class="mui-table-view has-m-top">
			<li class="mui-table-view-cell mui-media">
				<a id='goods'>
					<img id="userImg" class="mui-media-object mui-pull-left" src="img/pic1.png"/>
					<div class="mui-media-body has-top-padded">
						<p class='title' style='color:#333;'>最新华丽美版Ulthera 还你紧致童颜</p>
						
						<p class='mui-ellipsis'>
							售价：<span class="color-red" id='sPrice'>￥600</span>
						</p>
					</div>
				</a>
			</li>
			<li class="mui-table-view-cell mui-media">
				<a class="mui-navigate-right" id='hospita_a'>
					<div class="mui-media-body">
						<img class="icon-hospital" src="img/icon-hospital.png"/>
						<!--<i class="iconfont color-blue size-big">&#xe62e;</i>-->
						<p id='hospitalName'style='display: inline-block;color:#333;padding-left:6px;'>上海春夏秋冬外科整形医院</p>
						<p class="mui-ellipsis" style="padding-left: 24px;" id='address'>
							上海市黄浦区人民广场路1号
						</p>
					</div>
				</a>
			</li>
			<li class="mui-table-view-cell">
				<i class="iconfont size-sm color-blue">&#xe60a;</i>
				 <span>咨询电话：  <span id='telPhone'>021-2865379</span></span>
			</li>
		</ul>
		<ul class="mui-table-view lower-table-view">
			<li class="mui-table-view-cell no-after-line">
				订单金额
				<span class="mui-pull-right" id='payPrice'>￥680</span>
			</li>
			<li class="mui-table-view-cell no-after-line">
				代金券
				<span class="mui-pull-right" id='vouchers'>￥180</span>
			</li>
			<li class="mui-table-view-cell no-after-line delay" style="display: none;">
				分期金额
				<span class="mui-pull-right" id='installment'>￥380</span>
			</li>
			<li class="mui-table-view-cell no-after-line delay" style="display: none;">
				分期月数
				<span class="mui-pull-right" id='period'>3个月</span>
			</li>
			<li class="mui-table-view-cell no-after-line delay" style="display: none;">
				分期月供
				<span class="mui-pull-right" id='monthPay'>￥126.54 (含服务费￥22)</span>
			</li>
			<li class="mui-table-view-cell no-after-line">
				<span id='way'>首付</span>金额
				<span class="mui-pull-right color-red" id="firstPay">￥200</span>
			</li>
		</ul>
		<ul class="mui-table-view">
			<li class="mui-table-view-cell mui-media">
				<span class="size-sm">订单编号:<span id='order_no'>25412557</span></span>
				<span class="mui-pull-right size-sm" style="float: none;display: block;">下单时间:<span id='create_time'>2015-11-11  16:22:32</span></span>
			</li>
		</ul>
		<div class="btn-cont">
			<button class="mui-btn">取消订单</button>
			<button class="mui-btn mui-btn-negative">预约</button>			
		</div>
		<div id="dialogBg" style='width:100%;height: 100%;'></div>
		<div id="cancel-dialog" class="animated dialog">
				<p class="color-black text-cont-left">
					你已经成功预约，如果需要取消预约或取消
					订单，请先致电医院取消预约。
				</p>
				<ul class='btn-ul'>
					<li>
						<a class="close-pop" style='border-right: 1px solid #ECECEC;'>
							取消
						</a>
					</li>
					<li>
						<a href="tel:13983171812" id='hospitalPhone'>
							联系医院
						</a>
					</li>
				</ul>
		</div>
	</div>
	<script src='js/jquery.min.js'></script>
	<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
	<script type="text/javascript" src="http://www.meifenfen.com/user/jssdk.js"></script>	
	<script src='js/util.js'></script>
	<script>
	var w,h;
	var cancel_msg;
		function getSrceenWH(){
			w = $(window).width();
			h = $("html").height();
//			$('#dialogBg').width(w).height(h);
		}
		
		window.onresize = function(){  
			getSrceenWH();
		}  
		$(window).resize();  
		
		$(function(){
			getSrceenWH();
			//显示弹框
			$(document).on('click','#cancelBook',function(){
				$('#dialogBg').fadeIn(300);
				$('#cancel-dialog').removeClass('animated').addClass('animated dialog'+"bounceIn"+'').fadeIn();
			});
			
			//关闭弹窗
			$('.close-pop').click(function(){
				$('#dialogBg').fadeOut(300,function(){
					$('#cancel-dialog').removeClass('animated').addClass('animated dialog'+'bounceOutUp'+'').fadeOut();
				});
			});
		});
		var order_id = Common.UrlGet()['order_id']
		//页面加载，请求接口;
		$.ajax({
			xhrFields: {withCredentials: true},
		type:"post",
		url:"http://"+getHostName()+"/user/order_detail/?order_id="+order_id,
		dataType:'json',
		success:function(data){
			var hospital=data.hospital;
			var item=data.item;
			var order_info=data.order_info;
			var monthPay=order_info.period_amount+order_info.period_fee;
			if(order_info.credit_choice_id!=0){
				$('.delay').show();
				$('#way').html('应付')
			}else{
				$('#way').html('首付')
			}
			cancel_msg=data.cancel_msg
			$('#sPrice').html(order_info.total);
			$('.title').html(item.title);
			$('#address').html(hospital.addr);
			$('#telPhone').html(hospital.phone);
			$('#hospitalPhone').attr('href','tel:'+hospital.phone)
			$('#hospitalName').html(hospital.name);
			$('#userImg').attr('src',item.image);
			$('#payPrice').html('￥'+order_info.total);
			$('#installment').html('￥'+order_info.credit_amount);
			$('#period').html(order_info.period_count+'个月');
			$('#vouchers').html('-￥'+order_info.coupon_amount);
			$('#goods').attr('href','/static/user/detail.html?item_id='+order_info.item_id);
			document.title=order_info.status_labbel;
			if(order_info.coupon_amount==0){
				$('#vouchers').parent('li').hide();
			}
			$('#monthPay').html('￥'+monthPay+"(含服务费￥"+order_info.period_fee+")");
			if(order_info.price==0){
				$('#firstPay').parent('li').hide()
			}
			$('#firstPay').html(order_info.price);
			$('#create_time').html(order_info.create_time);
			$('#order_no').html(order_info.order_no);
			var node='';
			$('.btn-cont').find('button').remove();
			$('#hospita_a').attr('href','/user/hospital_detail/?hospital_id='+hospital.id)
			if(order_info.status==0){
				node='<a class="mui-btn" id="cancelPay">取消订单</a><a class="mui-btn mui-btn-negative">去支付</a>';
				$('.btn-cont').append(node);
			}else if(order_info.status==1){
				node='<a class="mui-btn" id="cancelPay">取消订单</a><a class="mui-btn mui-btn-negative">去支付</a>';
				$('.btn-cont').append(node);
			}
			else if(order_info.status==2){
				node='<a class="mui-btn" id="cancelOrder">取消订单</a><a class="mui-btn mui-btn-negative" href=tel:'+hospital.phone+'>预约</a>';
				$('.btn-cont').append(node);
				$('#dontUse').show();
				$('#dontUse').find('h4').html(data.service_code)
			}else if(order_info.status==3){
				
			}else if(order_info.status==4){
				node='<a class="mui-btn" style="width:92%;" id="cancelBook">取消订单</a>';
				$('#dontUse').show();
				$('#dontUse').find('h4').html(data.service_code)
				$('.btn-cont').append(node);
			}else if(order_info.status==5){
				node='<a class="mui-btn mui-btn-negative" " href="judge-look.html?item_id='+order_info.item_id+'">查看评价</a><a class="mui-btn mui-btn-negative" href="judge-edit.html?order_id='+order_info.id+'">追加评价</a>';
				$('#use').show();
				$('#use').find('h4').html(data.service_code)
				$('.btn-cont').append(node);
			}else if(order_info.status==6){
				node='<a class="mui-btn mui-btn-negative mui-btn-block" style="width:92%;" href="judge-edit.html?order_id='+order_info.id+'">去评价</a>';
				$('#use').show();
				$('#use').find('h4').html(data.service_code)
				$('.btn-cont').append(node);
			}else if(order_info.status==7){
				node='<a class="mui-btn mui-btn-negative mui-btn-block" style="width:92%;" href="detail.html?item_id='+item.id+'">重新购买</a>';
				$('.btn-cont').append(node);
			}else if(order_info.status==8){
				node='<a class="mui-btn mui-btn-block" style="width:92%;" id="cancelOrder">取消订单</a>';
				$('#audit').show();				
				$('.btn-cont').append(node);
			}else if(order_info.status==9){
				node='<a class="mui-btn mui-btn-block" style="width:92%;" id="cancelOrder">取消订单</a>';
				node='<a class="mui-btn" id="cancelBook">取消订单</a><a class="mui-btn mui-btn-negative" id="done" data='+order_info.id+'>已完成</a>';
				$('#use').show();
				$('#use').find('h4').html(data.service_code)
				$('.btn-cont').append(node);
			}else if(order_info.status==10){
				node='<a class="mui-btn mui-btn-negative mui-btn-block" style="width:92%;" href="detail.html?item_id='+item.id+'">重新购买</a>';
				$('.btn-cont').append(node);
			}else if(order_info.status==11){
				node='<a class="mui-btn mui-btn-negative mui-btn-block" style="width:92%;" href="/user/menu_credit_apply/">查看</a>';
				$('.btn-cont').append(node);
			}
			

			 // 取消订单接口
            $(document).on('click','#cancelOrder',function(){
                if(confirm(data.cancel_msg)){
                        $.ajax({
                        xhrFields: {withCredentials: true},
                        type:"post",
                        url:"http://"+getHostName()+"/user/cancel_order/",
                        dataType:'json',
                        data:{order_id:order_id},
                        success:function(data){
                            if(data.code==0){
                                alert(data.msg);
                                window.location=location;
                            }else{
                                alert(data.msg);
                            }
                            
                        },error:function(){
                            
                        }
                    });
                }else{
                    
                }       
            })
			
			
		},
		error:function(){
			alert('网络出现小差，请稍后再试');
		}
	});
	$(document).on('click','#cancelPay',function(){
		if(confirm(cancel_msg)){
				$.ajax({
				xhrFields: {withCredentials: true},
				type:"post",
				url:"http://"+getHostName()+"/user/cancel_pay/",
				dataType:'json',
				data:{order_id:order_id},
				success:function(data){
					if(data.code==0){
						alert(data.msg);
						window.location=location;
					}else{
						alert(data.msg);
					}
					
				},error:function(){
					
				}
			});
		}else{
			
		}		
	});

		$(document).on('click','#done',function(){
		var order_id=$(this).attr('data');
				$.ajax({
				xhrFields: {withCredentials: true},
				type:"post",
				url:"http://"+getHostName()+"/user/finish_order/",
				dataType:'json',
				data:{order_id:order_id},
				success:function(data){
					if(data.code==0){
						alert(data.msg);
						window.location=location;
					}else{
						alert(data.msg);
					}
					
				},error:function(){
					
				}
			});	
	})

	
	
	</script>
</body>
</html>
























